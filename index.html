<!DOCTYPE html>
<html>
<head>
  <title>ä¸“å±ç¾é£Ÿè½®ç›˜</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
  <style>
    /* æ ¸å¿ƒæ ·å¼ */
    body {
      background: linear-gradient(135deg, #ffe6f2, #ffd9eb);
      font-family: 'Microsoft YaHei', cursive;
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 600px;
      margin: 0 auto;
    }

    .wheel-container {
      position: relative;
      width: 300px;
      height: 300px;
      margin: 20px auto;
      filter: drop-shadow(0 0 20px rgba(255,105,180,0.2));
    }

    .background {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background: #fff;
      box-shadow: 0 0 30px #ff99cc;
    }

    canvas {
      position: absolute;
      top: 0;
      left: 0;
    }

    .pointer {
      position: absolute;
      width: 40px;
      top: -20px;
      left: 130px;
      z-index: 2;
      filter: drop-shadow(0 0 8px #ff1493);
      transform-origin: 50% 100%;
      animation: pointerFloat 2s ease-in-out infinite;
    }

    @keyframes pointerFloat {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-5px); }
    }

    /* æ§åˆ¶æŒ‰é’®æ ·å¼ */
    .controls {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin: 20px 0;
    }

    .controls button {
      background: linear-gradient(45deg, #ff85b2, #ff69b4);
      border: none;
      padding: 12px 25px;
      border-radius: 25px;
      color: white;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 4px 15px rgba(255,105,180,0.3);
    }

    .controls button:hover {
      transform: scale(1.05);
      box-shadow: 0 6px 20px rgba(255,105,180,0.4);
    }

    /* é€‰é¡¹é¢æ¿ */
    .options-panel {
      background: rgba(255,255,255,0.95);
      padding: 20px;
      border-radius: 20px;
      margin: 20px auto;
      max-width: 400px;
      backdrop-filter: blur(10px);
    }

    #optionsList li {
      background: #fff;
      padding: 12px;
      margin: 8px 0;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      transition: all 0.3s;
      box-shadow: 0 2px 8px rgba(255,153,204,0.1);
    }

    #optionsList li:hover {
      transform: translateX(10px);
      box-shadow: 0 4px 15px rgba(255,153,204,0.2);
    }
  </style>
</head>
<body>
  <div class="container">
    <h1 style="text-align:center; color:#ff69b4; text-shadow:2px 2px 4px rgba(255,105,180,0.2);">ğŸ´ ä»Šå¤©ç¿»è°çš„ç‰Œå­ï¼Ÿ ğŸ‘‘</h1>
    
    <div class="wheel-container">
      <img id="background" class="background" src="default-bg.jpg">
      <canvas id="wheel"></canvas>
      <img src="pointer.png" class="pointer">
    </div>

    <div id="result" style="text-align:center; min-height:120px;"></div>

    <div class="options-panel">
      <h3 style="color:#ff69b4; margin-bottom:15px;">ğŸ“œ ç¾é£Ÿåå½• ğŸ“œ</h3>
      <ul id="optionsList"></ul>
    </div>

    <div class="controls">
      <button onclick="addOption()">â• æ·»åŠ é€‰é¡¹</button>
      <button onclick="spin()">ğŸ¡ å¼€å§‹ç”¨è†³ï¼</button>
      <button onclick="exportData()">ğŸ“¥ å¤‡ä»½æ•°æ®</button>
      <button onclick="importData()">ğŸ“¤ æ¢å¤æ•°æ®</button>
    </div>
  </div>

  <audio id="spinSound" src="spin-sound.mp3"></audio>
  <audio id="resultSound" src="success-sound.mp3"></audio>

  <script>
    // åˆå§‹åŒ–é…ç½®
    let options = JSON.parse(localStorage.getItem('foodWheelData')) || [];
    const colors = ["#ffb3d9", "#ffcccc", "#ffd9e6"];
    let isSpinning = false;

    // æ ¸å¿ƒåŠŸèƒ½
    function drawWheel() {
      const canvas = document.getElementById('wheel');
      const ctx = canvas.getContext('2d');
      const size = 300;
      canvas.width = size;
      canvas.height = size;

      ctx.clearRect(0, 0, size, size);
      const sliceAngle = (2 * Math.PI) / options.length;

      options.forEach((option, index) => {
        ctx.beginPath();
        ctx.fillStyle = colors[index % 3];
        ctx.moveTo(size/2, size/2);
        ctx.arc(size/2, size/2, size/2, index*sliceAngle, (index+1)*sliceAngle);
        ctx.fill();

        // ç»˜åˆ¶æ–‡å­—
        ctx.save();
        ctx.translate(size/2, size/2);
        ctx.rotate(index*sliceAngle + sliceAngle/2);
        ctx.fillStyle = "#fff";
        ctx.font = "bold 14px 'Microsoft YaHei'";
        ctx.textAlign = "right";
        ctx.fillText(option.name, 140, 5);
        ctx.restore();
      });
    }

    function spin() {
      if (isSpinning) return;
      if (options.length < 2) return alert("è‡³å°‘éœ€è¦ä¸¤ä¸ªé€‰é¡¹å“¦~");
      
      isSpinning = true;
      const resultDiv = document.getElementById('result');
      resultDiv.innerHTML = '<div class="loading">ğŸ³ å¾¡å¨æ­£åœ¨é¢ å‹º...</div>';
      document.getElementById('spinSound').play();

      const rotations = 5 + Math.random() * 3;
      const targetAngle = rotations * 360 + Math.random() * 360;
      const wheel = document.querySelector('.wheel-container');
      
      wheel.style.transition = 'transform 3.5s cubic-bezier(0.25, 0.1, 0.25, 1)';
      wheel.style.transform = `rotate(${targetAngle}deg)`;

      setTimeout(() => {
        const finalAngle = targetAngle % 360;
        const selectedIndex = Math.floor((360 - finalAngle) / (360 / options.length)) % options.length;
        showResult(options[selectedIndex]);
        document.getElementById('resultSound').play();
        isSpinning = false;
      }, 3500);
    }

    function showResult(option) {
      const resultDiv = document.getElementById('result');
      resultDiv.innerHTML = `
        <div style="animation: fadeIn 0.5s">
          <h3 style="color:#ff69b4; margin:10px 0;">âœ¨ é’¦ç‚¹ âœ¨</h3>
          <div style="font-size:1.2em; margin:10px 0;">${option.name}</div>
          <img src="${option.image}" 
               style="width:180px; height:180px; 
                      border-radius:15px; border:3px solid #ff99cc;
                      box-shadow:0 4px 15px rgba(255,105,180,0.3)">
        </div>
      `;
    }

    // æ•°æ®ç®¡ç†åŠŸèƒ½
    function addOption() {
      const name = prompt("è¯·è¾“å…¥ç¾é£Ÿåç§°ï¼š");
      const image = prompt("è¯·è¾“å…¥å›¾ç‰‡URLï¼š");
      if (name && image) {
        options.push({ name, image });
        refreshOptionList();
        saveData();
        drawWheel();
      }
    }

    function refreshOptionList() {
      const list = document.getElementById('optionsList');
      list.innerHTML = options.map((opt, index) => `
        <li data-index="${index}">
          <span>${index + 1}. ${opt.name}</span>
          <img src="${opt.image}" 
               style="width:40px; height:40px; 
                      border-radius:50%; object-fit:cover;
                      border:2px solid #ff99cc">
        </li>
      `).join('');
      initListInteractions();
    }

    function initListInteractions() {
      // åŒå‡»ç¼–è¾‘
      document.querySelectorAll('#optionsList li').forEach(item => {
        item.ondblclick = function() {
          const index = this.dataset.index;
          const newName = prompt("ä¿®æ”¹åç§°ï¼š", options[index].name);
          const newImage = prompt("æ–°å›¾ç‰‡URLï¼š", options[index].image);
          if (newName && newImage) {
            options[index] = { name: newName, image: newImage };
            refreshOptionList();
            saveData();
            drawWheel();
          }
        }
      });

      // æ‹–æ‹½æ’åº
      new Sortable(document.getElementById('optionsList'), {
        animation: 150,
        onEnd: function(evt) {
          const movedItem = options.splice(evt.oldIndex, 1)[0];
          options.splice(evt.newIndex, 0, movedItem);
          saveData();
          drawWheel();
        }
      });
    }

    // æ•°æ®æŒä¹…åŒ–
    function saveData() {
      localStorage.setItem('foodWheelData', JSON.stringify(options));
    }

    // å¯¼å…¥å¯¼å‡ºåŠŸèƒ½
    function exportData() {
      const dataStr = JSON.stringify(options);
      const blob = new Blob([dataStr], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `ç¾é£Ÿè½®ç›˜å¤‡ä»½_${new Date().toLocaleDateString()}.json`;
      a.click();
      setTimeout(() => URL.revokeObjectURL(url), 100);
    }

    function importData() {
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = 'application/json';
      input.onchange = function(e) {
        const file = e.target.files[0];
        const reader = new FileReader();
        reader.onload = function() {
          try {
            options = JSON.parse(this.result);
            refreshOptionList();
            saveData();
            drawWheel();
            alert('æ•°æ®æ¢å¤æˆåŠŸï¼');
          } catch (error) {
            alert('æ–‡ä»¶æ ¼å¼é”™è¯¯ï¼');
          }
        };
        reader.readAsText(file);
      };
      input.click();
    }

    // åˆå§‹åŒ–
    window.onload = () => {
      refreshOptionList();
      drawWheel();
    }
  </script>
</body>
</html>